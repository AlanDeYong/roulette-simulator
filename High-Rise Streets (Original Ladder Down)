const highRiseStreetsOriginal = {
    name: "High-Rise Streets (Original Ladder Down)",
    description: "7-level progression on Streets. Ladder up on loss, ladder down on win.",
    
    // UPDATED: Bet amounts doubled to meet default $2 table minimum
    progression: [
        { level: 1, streets: 3, betPerStreet: 2 },
        { level: 2, streets: 4, betPerStreet: 2 },
        { level: 3, streets: 5, betPerStreet: 4 },
        { level: 4, streets: 6, betPerStreet: 4 },
        { level: 5, streets: 7, betPerStreet: 10 },
        { level: 6, streets: 8, betPerStreet: 10 },
        { level: 7, streets: 9, betPerStreet: 20 }
    ]
};

// Main Bet Function
function bet(spinHistory, bankroll, config, state) {
    const levels = highRiseStreetsOriginal.progression;

    // Initialize state if needed (starts at Level 1 / Index 0)
    if (state.currentLevelIndex === undefined) {
        state.currentLevelIndex = 0;
    }

    // --- 1. DETERMINE OUTCOME OF LAST SPIN ---
    if (spinHistory.length > 0) {
        const lastSpin = spinHistory[spinHistory.length - 1];
        const lastNum = lastSpin.winningNumber; 

        // We check the level used in the PREVIOUS spin
        const prevLevelConfig = levels[state.currentLevelIndex];
        const coveredStreetsCount = prevLevelConfig.streets;
        const maxCoveredNumber = coveredStreetsCount * 3;

        let wonLast = false;
        // Check if won (37 is 00, 0 is 0)
        if (lastNum !== 0 && lastNum !== 37 && lastNum <= maxCoveredNumber) {
            wonLast = true;
        }

        // --- 2. ADJUST PROGRESSION LEVEL ---
        if (wonLast) {
            // WIN: Ladder Down 1 level
            state.currentLevelIndex = Math.max(0, state.currentLevelIndex - 1);
        } else {
            // LOSS: Ladder Up 1 level
            if (state.currentLevelIndex + 1 >= levels.length) {
                state.currentLevelIndex = 0; // Reset after bust
            } else {
                state.currentLevelIndex++;
            }
        }
    }

    // --- 3. CONSTRUCT NEW BETS ---
    const currentConfig = levels[state.currentLevelIndex];
    
    const bets = [];
    for (let i = 0; i < currentConfig.streets; i++) {
        bets.push({ 
            type: 'street', 
            // 'value' must be the start number of the street (1, 4, 7...)
            value: (i * 3) + 1, 
            amount: currentConfig.betPerStreet 
        }); 
    }

    return bets;
}
